name: Update Leaderboard Data

on:
  # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (í•œêµ­ì‹œê°„ ê¸°ì¤€)ì— ì‹¤í–‰
  schedule:
    - cron: '0 0 * * *'  # UTC 00:00 = KST 09:00
  
  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥í•˜ë„ë¡
  workflow_dispatch:

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      run: npm ci --legacy-peer-deps
      
    - name: ğŸ”„ ë¦¬ë”ë³´ë“œ ë°ì´í„° ìƒì„±
      env:
        VITE_AIRTABLE_API_KEY: ${{ secrets.VITE_AIRTABLE_API_KEY }}
        VITE_BASE_ID: ${{ secrets.VITE_BASE_ID }}
        VITE_TABLE_NAME: ${{ secrets.VITE_TABLE_NAME }}
      run: node scripts/generate-leaderboard.js
      
    - name: ğŸ—ï¸ í”„ë¡œì íŠ¸ ë¹Œë“œ
      run: npm run build
      
    - name: ğŸš€ Vercel ë°°í¬
      env:
        VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
        VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
      run: |
        npm install -g vercel
        vercel --token $VERCEL_TOKEN --prod --yes
        
    - name: âœ… ì™„ë£Œ ì•Œë¦¼
      run: |
        echo "ğŸ‰ ë¦¬ë”ë³´ë“œ ìë™ ì—…ë°ì´íŠ¸ ì™„ë£Œ!"
        echo "ğŸ“… ì—…ë°ì´íŠ¸ ì‹œê°„: $(date)"
        echo "ğŸ”— ì‚¬ì´íŠ¸: https://reels-leaderboard.vercel.app"

